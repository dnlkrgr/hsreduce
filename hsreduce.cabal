cabal-version:       3.0
name:                hsreduce
version:             0.1.0.0
license:             BSD-3-Clause
license-file:        LICENSE
build-type:          Simple
extra-source-files:  ChangeLog.md

common dry
    build-depends:       
        base
        , MonadRandom
        , bytestring
        , containers
        , directory
        , ghc
        , microlens-platform
        , mtl
        , path
        , stm
        , temporary
        , text
        , time
        , uniplate
        , unix
        , word8
        , ghc-paths
        , process
        , Cabal
        , aeson
        , cassava
    default-extensions:
        GeneralizedNewtypeDeriving 
        LambdaCase
        OverloadedStrings 
        PatternSynonyms
        QuasiQuotes
        RecordWildCards
        ScopedTypeVariables
        TemplateHaskell
    default-language:    
        Haskell2010
    ghc-options:       
        -Wall

executable hsmerge
    import:
        dry
    main-is: Main.hs
    other-modules:
        HsAllInOne
    build-depends:       
        hashable
        , edit-distance
        , hie-bios
        , lib-util
    hs-source-dirs:      
        src/Merge
    default-extensions:  
        FlexibleInstances
    
executable hsreduce
    main-is: 
        Main.hs
    build-depends:       
        base
        , lib-hsreduce
    hs-source-dirs:    
        src
    default-language:  
        Haskell2010
    default-extensions:  
        LambdaCase
    ghc-options:       
        -Wall 
        -threaded 
        -rtsopts
        -with-rtsopts=-T

library lib-hsreduce
    import:
        dry
    exposed-modules:   
        HsReduce
        Passes.Stubbing
        Passes.DataTypes
        Passes.Names
        Passes.Functions
        Passes.RemoveUnused.Decls
        Passes.RemoveUnused.Imports
        Passes.RemoveUnused.Exports
        Passes.RemoveUnused.Pragmas
        Passes.RemoveUnused.Parameters
    build-depends:       
        lib-util
    hs-source-dirs:    
        src/Reduce
    default-extensions:  
        Rank2Types  
        TypeFamilies
        ViewPatterns

library lib-util
    import:
        dry
    build-depends:
        megaparsec
        , regex
        , syb
        , async
        , split
        , ghc-boot-th
    exposed-modules:   
        Util.Util
        Util.Types
        Parser.Parser
    hs-source-dirs:    
        src
    default-extensions:  
        DeriveGeneric

test-suite test-hsreduce
    import: 
        dry
    type: 
        exitcode-stdio-1.0
    main-is: 
        Test.hs
    hs-source-dirs: 
        test
    build-depends: 
        lib-hsreduce
        , lib-util
        , hspec
    default-language:  
        Haskell2010